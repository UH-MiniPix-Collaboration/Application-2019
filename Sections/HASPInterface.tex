\section{HASP Interface}
\label{sec:HaspInterface}

\subsection{Interfacing with HASP: Serial Uplink and Downlink}
During the duration of our flight the serial uplink commands will be used to configure the collection parameters of the MiniPIX radiation detector. When a command is received from the mission control team, it will be transmitted straight through the DB9 connection into the RPI3 through an RS232 to ttl converter. Then the monitoring script on the RPI3 will verify its content and perform the appropriate action defined in Table~\ref{tab:All-Commands}. The baud rate for serial communication will be set to 4800 bits per second ($bits/sec$). 


\begin{table}[!ht]
  \centering
  \caption{Table of All Uplink Command} 
  \label{tab:All-Commands}
  \bigskip
  \begin{tabular}{c|c|c}
    \multicolumn{1}{c|}{\bfseries Command} & \multicolumn{1}{c|}{\bfseries HEX Uplink Command} & \multicolumn{1}{c}{\bfseries HEX Uplink Argument}\\
    \hline
    \hline
    Begin Acquisitions & 0x01 & N/A \\ 
    Stop Acquisitions & 0x02 & N/A \\ 
    Set Shutter Time & 0x03 & Shutter Time in seconds (1-255) \\ 
    Change Acquisition Mode & 0x04 & HEX Mode Identifier \\
    Device Reset & 0x05 & N/A \\
  \end{tabular}
  \medskip
\end{table}

\begin{table}[!ht]
  \centering
  \caption{Table of Acquisition Modes} 
  \label{tab:Acq-Commands}
  \bigskip
  \begin{tabular}{c|c|c}
    \multicolumn{1}{c|}{\bfseries Acquisition Mode} & \multicolumn{1}{c|}{\bfseries Hex Mode Identifier} & \multicolumn{1}{c}{\bfseries Description} \\
    \hline
    \hline
    Automatic Shutter Time & 0x01 & Shutter time determined automatically based on particle flux \\
    Fixed Shutter Time & 0x02 & Shutter time fixed to set shutter time \\ 
    Counting Mode & 0x03 & Configure MiniPIX to measure counts on the detector only \\
    ToT Mode & 0x04 & Configure MiniPIX to measure time over threshold values \\
    ToA Mode & 0x05 & Configure MiniPIX to measure time of arrival \\
  \end{tabular}
  \medskip
\end{table}


\subsection{Interfacing with HASP: EDAC and DB9 Connections}

The power supply unit (PSU) will use a +30V and ground line from the EDAC connection. The linear actuator of the collection system will use +12V and the collection arm servo motor will take a +6V connection. Other Sensors will be powered through the Arduino taking +5V through the previously described USB connection.  

We will use discrete commands in this mission.  Two of the commands will be used to deploy and retract the astrobiology system.  This is only in case of emergency if we notice that the system has not already deployed at the planned altitude as designed. The other two discrete channels will be used to turn on and off the power of RESU in case that we notice an issue.

\begin{table}[!ht]
  \centering
  \caption{Table of all discrete commands to be used during flight} 
  \label{tab:Dis-Commands}
  \bigskip
  \begin{tabular}{c|c|c|c}
    \multicolumn{1}{c|}{\bfseries Command} & \multicolumn{1}{c|}{\bfseries Purpose} &  \multicolumn{1}{c|}{\bfseries EDAC Pin} & \multicolumn{1}{c}{\bfseries Description} \\
      \hline
      \hline
      Discrete 1 & Astro. System ON & f & Extends collection arm and activates rotation \\
      Discrete 2 & Astro. System OFF & n & Stops collection arm rotation and retracts arm \\
      Discrete 3 & RESU ON & h & Powers up RESU \\
      Discrete 4 & RESU OFF & p & Shuts down RESU \\
  \end{tabular}
  \medskip
\end{table}

\subsection{Interfacing with HASP: Serial Downlink}
For the duration of the flight the serial downlink will be used to downlink the temperature and other various statistics that will be computed directly on the RP\num{3} as data is collected. It will also be used to downlink messages regarding the status of the payload, the command uplink status and error messages. The data packets will be human readable so they can be analyzed directly as they are received from HASP. The packets will be delimited by keywords \verb|begin_packet| and \verb|end_packet| and we will use a simple one character header to differentiate between data packets and message packets. The format of the packets is potentially subject to change but the current design is outlined in listing~\ref{Downlinks} .
